\documentclass[twocolumn]{article}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{url}

\begin{document}
For crystalline materials  with disordered sub-lattices such as the Li ion solid state electrolyte  Li$_2$OHCl it is desirable to calculate from first principles methods the density of energy states $G(E_j)$. With the energy density of states the partition function,
\begin{equation}
\begin{split}
Z = \sum_{i}^{\Omega}e^{\frac{-e_i}{k_B T} }= \sum_{j}^{\Pi}G(E_j)e^{\frac{-E_j}{k_BT}} \;,
\end{split}
\end{equation}
 can be exactly calculated an from it many important properties of interest determined. Properties of interest calculated from the partition function include  free energy, entropy, specific heat, and ensemble averages. One method to solve this problem could be temperature dependent simulations involving  Metropolis algorithm and histogram re-weighting techniques\cite{landau_MC_simulations}.  Another algorithm called the  Wang and Landau algorithm\cite{WL_phys_rev_lett} has been developed which is temperature independent. An issue with these algorithms in use with first principles methods such as density functional theory is the large number of iterations needed which would require a prohibitively long wall time at the current performance power of computers.  In this paper a method is proposed that combines the use of random sets along with the importance sampling method of the Wang and Landau algorithm that is meant to work towards the goal of highly parallel importance sampling algorithms that mesh well with high performance computing architectures. The algorithm developed in this work is referred to as the ``B$_{L}$ENDER" (B$_{L}$end Each New Density Each Round) algorithm. The name ``B$_{L}$ENDER" functions as an acronym and adjective which comes in part because how it blends the ideas of a random set and the Wang and Landau method, and also due to the nature of the algorithm iteratively blending histograms to produce a converged density of states.  The Wang and Landau method does have parallel versions, including  restricting random walkers to specific energy ranges or allowing the walkers to explore the entire space while periodically communicating with each other \cite{MP_Wang_Landau,P_imp_Wang_Landau, Hframe_Wang_Landau}. The ``B$_{L}$ENDER" is natural to parallelize as it is based on a set of random walkers that each can explore the entire energy range. It is hoped that due to the ``B$_{L}$ENDER" being presented in the form of sets that the mathematics of set theory and real analysis can be used to analyze the algorithm and possibly further extended its capabilities from those presented in this work. 

In a previous paper the notion of the master set $\{ \Sigma_i, e_i \}_\Omega $ of the $\Omega$ total configurations and energies was put forth. The master set refers to the actual configurations of the defined system. In practice to calculate the density of energy states $G(E_j)$  may be possible through randomly sampling the configurations space.  In a previous work it was shown that a properly scaled histogram of a uniformly sampled random set $\{ \Sigma_s, e_s \}_\mathcal{S}$ converges to the exact density of states $G(E_j)$ as the the number of samples $\mathcal{S}$ goes to infinity. The problem with this method is that if $\Omega$ is large, which it is for many problems,  then the computationally effort to achieve convergence is not feasible.  This work tackles this issue and produces an algorithm that is highly parallel in terms of the calculations of the energies  but also incorporates importance sampling such as in the Wang and Landau method. 

The ``B$_{L}$ENDER" algorithm proposed in this work  is given as follows. It is noted that the following algorithm is in terms of producing a relative density of states $H(E_j)$.  \\
\begin{equation}
\begin{split}
&1.\hspace{0.125cm} H(E_j)^i ,\hspace{0.15cm}  \{\Sigma_{s},e_s\}_{\mathcal{S}}^i\\
&2. \hspace{0.125cm}\{\Sigma_{s},e_s\}_{\mathcal{S}}^i \rightarrow  \{\Sigma_{s}^{'},e_s^{'}\}_{\mathcal{S}}^i\\
&3. \hspace{0.125cm}H(E_j)^{Ii} = H(E_j)^i + \mathcal{H}(E_j, \{e_{s}^{'}\}_{\mathcal{S}}^i) \\
&4. \hspace{0.125cm} \Sigma_{s}^{i'}, e_s^{i'} \rightarrow \Sigma_{s}^{i+1},e_s^{i+1}   \hspace{0.125cm} P = \hspace{0.075cm} min (1, H(e_s)^{Ii}/H(e_s^{'})^{Ii})\\
& \hspace{0.125cm}else  \hspace{0.15cm} \Sigma_{s}^i, e_s^i \rightarrow \Sigma_{s}^{i+1}, e_s^{i+1}\\
&5. \hspace{0.125cm} H(E_j)^{i+1} = H(E_j)^{i} + C_o\mathcal{H}(E_j, \{e_s\}_{\mathcal{S}}^{i+1})\frac{H(E_j)^{Ii}}{\sum_j H(E_j)^{Ii} }\\
&6. \hspace{0.125cm} N = \sum_j H(E_j)^{i+1} \hspace{0.125cm}\\
& if \hspace{0.125cm} H(E_j)^{i+1}\frac{\Omega}{N}  < 1, \hspace{0.125cm}  H(E_j)^{i+1} = H(E_j)^{i+1} \frac{N}{\Omega}
\end{split}
\end{equation}
Where  $H(E_j)^0 \equiv \mathcal{H}(E_j,\{e_s\}_{\mathcal{S}}^0)$ with $\mathcal{H}(E_j,\{e_s\}_{\mathcal{S}})$ being a histogram function that counts the number of energies $E_j$ in the set $\{e_s\}_{\mathcal{S}}$. In this work $\{\Sigma_{s},e_s\}_{\mathcal{S}}^0$  are a randomly(uniformly) drawn set from the configuration space $\{ \Sigma_i, e_i \}_\Omega $. In the second step  a random change is applied to each element of the sampled set $\{\Sigma_{s},e_s\}_{\mathcal{S}}^i$ to produced a ``perturbed" set $ \{\Sigma_{s}^{'},e_s^{'}\}_{\mathcal{S}}^i$ , for the Ising model this could be randomly flipping a spin. In the third step a histogram of the ``perturbed" set is added to the current estimate of the density of states $H(E_j)^i$ to produce an intermediary density of states $H(E_j)^{Ii}$. In the fourth step a random number is drawn between zero and one for every sampled configuration, if this number is less then the ratio of the density of states $H(e_s)^{Ii}/H(e_s^{'})^{Ii}$ then the perturbed configuration and energy  $\Sigma_{s}^{'i},e_s^{i'}$  goes to $\Sigma_{s}^{i+1},e_s^{i+1}$,  else the unperturbed configuration and energy $\Sigma_{s}^{i},e_s^i$  goes to $\Sigma_{s}^{i+1},e_s^{i+1}$. In the fifth step a histogram of the updated $\{ e_s \}^{i+1}_{\mathcal{S}}$ energies is made and added (blended) in to the current density of states $H(E_j)^i$   by multiplying  by a constant $C_{o}$(which effects convergence properties) and the relative probability of each energy $E_j$ in the the intermediary density of states $H(E_j)^{Ii}$. In this work it was found a $C_{o}=\Omega$ was computationally efficient.The sixth step corrects for a systematic error of a energy having a density of state less than one, in principle for a discrete system a given energy should have a density of state of a least one.  After the algorithm is deemed to be complete it is necessary to re-normalize the iterated relative density of states $H(E_j)^f$ at the final iteration $f$ as follows, 
\begin{equation}
\begin{split}
&1. \hspace{0.125cm} A = \sum_jH(E_j)^f\\
&2. \hspace{0.125cm} G(E_j)\approx H(E_j)^f \frac{\Omega}{A} \;,
\end{split}
\end{equation}
to produce the properly normalized estimated value of $G(E_j)$. 

In this work the algorithm discussed is tested using the 2-d zero field  Ising model.  The configurations $\Sigma_i$ and energies $e_i$ of the 2-d Ising model are inherently defined by the lattice site spin variables $\sigma^i_{k,l}$ and coupling constant $J$. In a previous study uniform sampling was used with first principles simulations to approximate the partition function for a $2\times 2\times 2$ supercell  of Li$_2$OHCl. In going to just a $3\times 3\times 3$ the value of $\Omega$ would jump from $\sim1e7$ to  $\sim1e26$. So computing the partition function for the $3\times 3\times 3$ system of Li$_2$OHCl is intractable from uniform sampling. In this work a $10X10$ 2d-ising model with $\Omega \approx 1.3e30$ is used as an analogous system to predict the computational effort needed for the B$_L$ENDER algorithm to compute the partition function of a  $3\times 3\times 3$ supercell of Li$_2$OHCl.   A test of the convergence properties with respect to the number of samples $\mathcal{S}$. The first test is a test to show the convergence of the algorithm in terms of the number of samples $\mathcal{S}$ and the number of iterations of the algorithm. To test the accuracy of the simulations the results will be compared to the exact result solved by Beale \cite{Beale_2d_ising}. The accuracy of the simulation will be determined by, 
\begin{equation}
\epsilon(I,o)  = \frac{1}{\Pi} \sum_{j=1}^{\Pi}\frac{|\ln(G_{ex}(E_j))- \ln(G_{bl}(E_j,I,o))|}{\ln(G_{ex}(E_j))}\; . 
\end{equation}
\begin{figure}[h!]
(a)\hspace{0.1cm}average iterations to reach $\epsilon(I,o)=1\%$ vs $\mathcal{S}$\\
\includegraphics[width=7.5cm]{its_vs_S.png}\\
(b)\hspace{0.1cm}average iterations to find all energies vs $\mathcal{S}$\\
\includegraphics[width=7.5cm]{its_to_find.png}
\caption{\label{its_to}A log log (base 10) plot of the average iterations $I$ to reach $\epsilon(I,o)=1\%$ vs the set size $\mathcal{S}$ (a) and the average number of iterations $I$ to find all of the energies vs the set size $\mathcal{S}$ (b). Error bars represent a linear progatation of the standard deviation of mean for the average of $I$ in log$_{10}$($I$). }
\end{figure}
Where $G_{ex}(E_j)$ is the exact density of states, $G_{bl}(E_j,I,o)$ is the density of states at iteration number $I$ from initial conditions and trajectory $o$. To test the algorithm on the 10$\times$10 Ising model, 144 individual calculations were performs at  $\mathcal{S}=$ 1, 10 ,100 , 1e3, and 1e4. The number of iterations to find all the energies and the number of iterations to to reach $\epsilon(I,o)=1\%$ were recorded and averaged for each value of S. These results are shown in Fig \ref{its_to}  (a) and (b).  The plots show there is an exponential like decay in the benenfit(fewer iterations) of including more samples $\mathcal{S}$ in the set.  

 Now from Fig \ref{its_to} (a) we could take $\mathcal{S}=100$  as an approximate optimal value to attempt a calculation of the density of states of cubic Li$_2$OHCl. In willing to accept $\epsilon=10\%$ there is an approximate 10$\times$ reduction in the number of iterations. So for an accuracy of $\epsilon=10\%$ that gives an approximate number of iterations of $\sim 1e4$, which if the calculations of the energies took 1 minute would take  7 days. On the other hand if the level of accuracy needed was to just find all the energies which from the figure is $\sim$ 8000 iterations the calculation would take 5.5 days for 1 minute calculations of the energies. Another point to make is that for calculation of the free energy of a disordered phase, it is not completely necessary to find all energy levels, which was demonstrated in a previous work. At the current level of computing power the calculation of the energies is greater than 1 minute so it would still require too large of a computational effort to make utilizing this algorithm on the Li$_2$OHCl system feasible but if Moore's law continues within a decade it may be a viable option. Aside from that the algorithm could be used with first principles on smaller systems, with model Hamiltonians, or systems defined by a model potentials.  

 Once the energy density of states is obtained many important thermodynamic properties can be determined but it may be considered a draw back that ensemble averages of a general order parameter $a_i \equiv a(\Sigma_i)$ are not accessible.  It is shown in this work that this possible to achieve by considering the following equation, 
\begin{equation}
\begin{split}
&\langle a \rangle = \sum_i^{\Omega}a_i \frac{ e^{- \frac{e_i}{K_bT}  }}{Z} = \\
&\sum_j^{\Pi}<a_i>_{j}G(E_j)\frac{e^{-\frac{E_J}{K_bT} }}{Z} \; . 
\end{split} 
\end{equation}
Where $<a_i>_{j}$ is the linear/simple average of $a_i$ over all configurations with energy $E_j$. So if a running average of the visited values was made during the simulation then it may be possible to approximate ensemble averaged order parameters over the entire temperature range.  To test this the B$_L$ENDER algoriathm was applied to a 26$\times$26 ferromagnetic Ising model with zero field with $\mathcal{S}=$ 10 and 100 to calculate the ensemble average of the absolute value of the magnetication per lattice site $\langle |m| \rangle$. In Fig \ref{avg_mag} (a) and (b) the results of five seperate simulations are shown for $\mathcal{S}=$ 10 and 100.  The results show that the known phase transition behavior of the ferromagnetic Ising model is well represented which indicates that this is a viable method for calculating ensemble averaged order parameters and that a larger value of $\mathcal{S}$ appears to reduce the variability between separate calculations.  This calculation is also evidence of B$_L$ENDER being applicable to larger systems, although this is still small compared to the 256$\times$256 model tested by Wang and Landau. 
\begin{figure}[h!]
(a)\hspace{0.1cm} $\mathcal{S}=$10\\
\includegraphics[width=7.5cm]{M_vs_T_S10.png}\\
(b)\hspace{0.1cm}$\mathcal{S}=$100\\
\includegraphics[width=7.5cm]{M_vs_T_S100.png}
\caption{\label{avg_mag} The ensemble averaged absolute value of the magnetization per lattice site calculated with $\mathcal{S}=$10 and $\mathcal{S}=$100 until $\epsilon(I,o)=1\%$ shown in (a) and (b) respectively. Each plot displays five seperate calculations at each value of$\mathcal{S}$.  }
\end{figure}


\bibliography{Bib}
\bibliographystyle{unsrt}


\end{document}
